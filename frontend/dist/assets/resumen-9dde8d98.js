import{K as R,B as $,A as V,d as O,e as j,U as z,j as D,_ as F,f as C,k as T,g as U,w as E,h as L,o as r,c,a as e,F as q,r as I,t as i,D as N,u as s,I as b,y as H,x as f,z as w,i as k,p as K,b as M}from"./index-36a1cf88.js";const G=R("user",{persist:{key:"user",storage:localStorage,paths:["user"]},state:()=>({user:{name:"",neigborhood:"",address:"",phone_number:"",payment_method_option:""}}),getters:{fucion:t=>0},actions:{async func(){return func}}}),S=$(),x=V(),A=O(),p=G(),J=()=>{var m,d,l,n;const t=x.cart.products.map(a=>({product_instance_id:a.product.id,quantity:a.quantity})),o=x.cart.additions.map(a=>({aditional_item_instance_id:a.id,quantity:a.quantity}));A.location.site.site_id;const g=A.location.neigborhood.delivery_price,u=x.cart.order_notes,v={user_name:p.user.name,user_phone:(m=p.user.phone_number)==null?void 0:m.split(" ").join(""),user_address:` ${p.user.address} ${(l=(d=A.location)==null?void 0:d.neigborhood)==null?void 0:l.name}`||""};return{order_products:t,site_id:12,delivery_person_id:4,payment_method_id:(n=p.user.payment_method_option)==null?void 0:n.id,delivery_price:g,order_notes:u||"SIN NOTAS",user_data:v,order_aditionals:o}},Q={async sendOrder(){const t=J();if(!W(t))return null;try{S.setLoading(!0,`enviando tu pedido ${p.user.name}`);const o=await j.post(`${z}/order`,t);if(o.status===200)A.webSocket.send("pedido melo"),S.setLoading(!1,"enviando tu pedido"),p.user={name:"",neigborhood:"",address:"",phone_number:"",payment_method_option:""},x.cart={products:[],total_cost:0,additions:[]},D.push("/gracias");else return console.error("An error occurred while sending the order:",o.status),alert("An error occurred while sending the order. Please try again."),S.setLoading(!1,"enviando tu pedido"),null}catch(o){return console.error("An error occurred while sending the order:",o),S.setLoading(!1,"enviando tu pedido"),alert("An error occurred while sending the order. Please check your internet connection and try again."),null}}};function W(t){return t.order_products.every(o=>o.product_instance_id&&o.quantity)?!t.user_data.user_name||t.user_data.user_name.trim()==""||!t.user_data.user_phone||t.user_data.user_phone.trim()==""||!t.user_data.user_address||t.user_data.user_address.trim()==""?(alert("Sus datos estan incompletos por favor reviselos"),!1):!t.site_id||!t.delivery_price?(alert("Site information is missing. Please select a valid site."),!1):!0:(alert("Some products in your cart are missing details."),!1)}const h=t=>(K("data-v-10445bbf"),t=t(),M(),t),X={class:"p-1 my-5 md:my-0 col-12"},Y={style:{position:"sticky",top:"5rem","border-radius":"0.5rem","z-index":"1000"},class:"col-12 p-3 p-shadow m-0"},Z=h(()=>e("h5",null,[e("b",null,"Resumen")],-1)),ee=h(()=>e("h5",null,[e("b",null,"productos")],-1)),te={class:"grid mb-0 pb-0"},se={class:"col-6 py-2 mb-1"},oe={style:{"min-width":"3rem"}},re={class:"col-6 my-0 text-right py-2"},ne={class:"col-12 p-0 mt-1"},ae={class:"mb-0"},ie={class:"mb-1 text-center"},de={style:{display:"flex",width:"100%",gap:"1rem","justify-content":"space-between"}},le={class:"text adicion",style:{"text-transform":""}},ce={key:0,class:"pl-2 text-sm"},ue=h(()=>e("hr",{class:"p-0 mt-2"},null,-1)),_e={class:"grid"},pe=h(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Subtotal")])],-1)),he={class:"col-6 my-0 text-right py-0"},me=h(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Domicilio")])],-1)),ye={class:"col-6 my-0 text-right py-0"},be=h(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Total")])],-1)),ge={class:"col-6 my-0 text-right py-0"},ve={__name:"resumen",setup(t){const o=C(!1),g=T(),u=V(),v=O(),P=C({}),m=()=>{P.value=u.cart.additions.reduce((d,l)=>{let n=l.group;return d[n]||(d[n]=[]),d[n].push(l),d},{})};return U(()=>{m()}),E(()=>u.cart.additions,()=>{m()},{deep:!0}),(d,l)=>{const n=L("Button"),a=L("router-link");return r(),c("div",X,[e("div",Y,[Z,ee,(r(!0),c(q,null,I(s(u).cart.products,y=>(r(),c("div",te,[e("div",se,[e("span",null,[e("span",oe,[e("b",null,i(y.quantity),1)]),N(" "+i(y.product.product_name),1)])]),e("div",re,[e("span",null,i(s(b)(y.total_cost)),1)])]))),256)),e("div",ne,[(r(!0),c(q,null,I(P.value,(y,B)=>(r(),c("div",{class:"p-0 mb-2",key:B,style:{position:"relative","border-radius":"0.3rem"}},[e("div",ae,[e("span",ie,[e("b",null,i(B),1)]),(r(!0),c(q,null,I(y,_=>(r(),c("div",{key:_.aditional_item_instance_id,style:{display:"flex",gap:"1rem","align-items":"center"}},[e("div",de,[e("span",le,[e("span",null,[e("b",null,i(_.quantity),1)]),N(" "+i(_.name),1)]),_.price>0?(r(),c("span",ce,[e("b",null,i(s(b)(_.price*_.quantity)),1)])):H("",!0)])]))),128))])]))),128))]),ue,e("div",_e,[pe,e("div",he,[e("span",null,[e("b",null,i(s(b)(s(u).cart.total_cost)),1)])]),me,e("div",ye,[e("span",null,[e("b",null,i(s(b)(s(v).location.neigborhood.delivery_price)),1)])]),be,e("div",ge,[e("span",null,[e("b",null,i(s(b)(s(u).cart.total_cost+s(v).location.neigborhood.delivery_price)),1)])])]),s(g).path.includes("cart")?(r(),f(a,{key:0,to:"/SALCHIPAPAS/3"},{default:w(()=>[k(n,{outlined:"",icon:"pi pi-shopping-cart",label:"Seguir comprando",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})):(r(),f(a,{key:1,to:"/cart"},{default:w(()=>[k(n,{outlined:"",icon:"pi pi-arrow-left",label:"Volver al carrito",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})),s(g).path.includes("cart")?(r(),f(a,{key:2,to:"/pay"},{default:w(()=>[k(n,{iconPos:"right",icon:"pi pi-arrow-right",label:"Pedir",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}})]),_:1})):(r(),f(a,{key:3,to:"/pay"},{default:w(()=>[k(n,{disabled:o.value,onClick:l[0]||(l[0]=()=>{s(Q).sendOrder(),o.value=!0}),iconPos:"right",icon:"pi pi-arrow-right",label:"Finalizar pedido",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}},null,8,["disabled"])]),_:1}))])])}}},we=F(ve,[["__scopeId","data-v-10445bbf"]]);export{we as r,G as u};
