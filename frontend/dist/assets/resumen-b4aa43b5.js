import{A as T,z as P,d as V,e as $,U as j,N as D,j as F,_ as U,f as L,k as E,g as H,w as K,h as O,o as n,c,a as e,F as C,r as N,t as u,C as R,u as s,H as g,y as M,K as G,x as f,D as k,i as w,p as J,b as Q}from"./index-388c579a.js";import{u as z}from"./user-f3da1763.js";const x=T(),S=P(),I=V(),b=z(),W=()=>{var a,p,d,h;S.sending_order=!0;const t=S.cart.products.map(l=>({product_instance_id:l.product.id,quantity:l.quantity})),o=S.cart.additions.map(l=>({aditional_item_instance_id:l.id,quantity:l.quantity})),i=I.location.site.site_id,r=(a=b.user.payment_method_option)==null?void 0:a.id,_=r===7?0:I.location.neigborhood.delivery_price,q=S.cart.order_notes,v={user_name:b.user.name,user_phone:(p=b.user.phone_number)==null?void 0:p.split(" ").join(""),user_address:` ${b.user.address} ${(h=(d=I.location)==null?void 0:d.neigborhood)==null?void 0:h.name}`||""};return{order_products:t,site_id:i,delivery_person_id:4,payment_method_id:r,delivery_price:_,order_notes:q||"SIN NOTAS",user_data:v,order_aditionals:o}},X={async sendOrder(){const t=W(),o=P();if(!Y(t))return o.sending_order=!1,null;try{x.setLoading(!0,`enviando tu pedido ${b.user.name}`);const i=await $.post(`${j}/order`,t);if(i.status===200)o.sending_order=!1,o.last_order=i.data,x.setLoading(!1,"enviando tu pedido"),D.sendTrackingEvent("Purchase",{total:o.cart.total_cost,currency:"COP",items:o.cart.products.map(r=>({id:r.product.id,name:r.product.product_name,quantity:r.quantity,price:r.product.price}))}),F.push("/gracias");else return console.error("An error occurred while sending the order:",i.status),alert("An error occurred while sending the order. Please try again."),x.setLoading(!1,"enviando tu pedido"),o.sending_order=!1,null}catch(i){return console.error("An error occurred while sending the order:",i),x.setLoading(!1,"enviando tu pedido"),o.sending_order=!1,alert("An error occurred while sending the order. Please check your internet connection and try again."),o.sending_order=!1,null}}};function Y(t){const o=P();return t.order_products.every(i=>i.product_instance_id&&i.quantity)?!t.user_data.user_name||t.user_data.user_name.trim()==""||!t.user_data.user_phone||t.user_data.user_phone.trim()==""||!t.user_data.user_address||t.user_data.user_address.trim()==""?(alert("Sus datos estan incompletos por favor reviselos"),o.sending_order=!1,!1):!t.site_id||t.delivery_price==null?(alert("Site information is missing. Please select a valid site."),o.sending_order=!1,!1):!0:(alert("Some products in your cart are missing details."),o.sending_order=!1,!1)}const y=t=>(J("data-v-ca73e7b4"),t=t(),Q(),t),Z={class:"p-1 my-5 md:my-0 col-12"},ee={style:{position:"sticky",top:"5rem","border-radius":"0.5rem","z-index":"1000"},class:"col-12 p-3 p-shadow m-0"},te=y(()=>e("h5",null,[e("b",null,"Resumen")],-1)),oe=y(()=>e("h5",null,[e("b",null,"productos")],-1)),se={class:"grid mb-0 pb-0"},re={class:"col-6 py-2 mb-1"},ne={style:{"min-width":"3rem"}},ie={class:"col-6 my-0 text-right py-2"},ae={class:"col-12 p-0 mt-1"},de={class:"mb-0"},le={class:"mb-1 text-center"},ce={style:{display:"flex",width:"100%",gap:"1rem","justify-content":"space-between"}},ue={class:"text adicion",style:{"text-transform":""}},_e={key:0,class:"pl-2 text-sm"},pe=y(()=>e("hr",{class:"p-0 mt-2"},null,-1)),he={class:"grid"},ye=y(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Subtotal")])],-1)),me={class:"col-6 my-0 text-right py-0"},ge={class:"col-6 my-0 py-0"},be=y(()=>e("b",null,"Domicilio",-1)),ve=[be],fe={class:"col-6 my-0 text-right py-0"},ke={key:0,style:{color:"var(--primary-color)"}},we=y(()=>e("b",null,"Recoger en local",-1)),xe=[we],Se={key:1},Pe=y(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Total")])],-1)),qe={class:"col-6 my-0 text-right py-0"},Ae={__name:"resumen",setup(t){const o=L(!1),i=E(),r=P(),_=V(),q=z(),v=L({}),A=()=>{v.value=r.cart.additions.reduce((a,p)=>{let d=p.group;return a[d]||(a[d]=[]),a[d].push(p),a},{})};return H(()=>{var a;A(),((a=q.user.payment_method_option)==null?void 0:a.id)!=7?_.setNeighborhoodPrice():_.setNeighborhoodPriceCero()}),K(()=>r.cart.additions,()=>{A()},{deep:!0}),(a,p)=>{const d=O("Button"),h=O("router-link");return n(),c("div",Z,[e("div",ee,[te,oe,(n(!0),c(C,null,N(s(r).cart.products,l=>(n(),c("div",se,[e("div",re,[e("span",null,[e("span",ne,[e("b",null,u(l.quantity),1)]),R(" "+u(l.product.product_name),1)])]),e("div",ie,[e("span",null,u(s(g)(l.total_cost)),1)])]))),256)),e("div",ae,[(n(!0),c(C,null,N(v.value,(l,B)=>(n(),c("div",{class:"p-0 mb-2",key:B,style:{position:"relative","border-radius":"0.3rem"}},[e("div",de,[e("span",le,[e("b",null,u(B),1)]),(n(!0),c(C,null,N(l,m=>(n(),c("div",{key:m.aditional_item_instance_id,style:{display:"flex",gap:"1rem","align-items":"center"}},[e("div",ce,[e("span",ue,[e("span",null,[e("b",null,u(m.quantity),1)]),R(" "+u(m.name),1)]),m.price>0?(n(),c("span",_e,[e("b",null,u(s(g)(m.price*m.quantity)),1)])):M("",!0)])]))),128))])]))),128))]),pe,e("div",he,[ye,e("div",me,[e("span",null,[e("b",null,u(s(g)(s(r).cart.total_cost)),1)])]),e("div",ge,[e("span",{style:G(s(_).location.neigborhood.delivery_price==0?"text-decoration: line-through;":"")},ve,4)]),e("div",fe,[s(_).location.neigborhood.delivery_price==0?(n(),c("span",ke,xe)):(n(),c("span",Se,[e("b",null,u(s(g)(s(_).location.neigborhood.delivery_price)),1)]))]),Pe,e("div",qe,[e("span",null,[e("b",null,u(s(g)(s(r).cart.total_cost+s(_).location.neigborhood.delivery_price)),1)])])]),s(i).path.includes("cart")?(n(),f(h,{key:0,to:"/SALCHIPAPAS/3"},{default:k(()=>[w(d,{outlined:"",icon:"pi pi-shopping-cart",label:"Seguir comprando",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})):(n(),f(h,{key:1,to:"/cart"},{default:k(()=>[w(d,{outlined:"",icon:"pi pi-arrow-left",label:"Volver al carrito",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})),s(i).path.includes("cart")?(n(),f(h,{key:2,to:"/pay"},{default:k(()=>[w(d,{iconPos:"right",icon:"pi pi-arrow-right",label:"Pedir",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}})]),_:1})):(n(),f(h,{key:3,to:"/pay"},{default:k(()=>[w(d,{disabled:s(r).sending_order,onClick:p[0]||(p[0]=()=>{s(X).sendOrder(),o.value=!0}),iconPos:"right",icon:"pi pi-arrow-right",label:"Finalizar pedido",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}},null,8,["disabled"])]),_:1}))])])}}},Ie=U(Ae,[["__scopeId","data-v-ca73e7b4"]]);export{Ie as r};
