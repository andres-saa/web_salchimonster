import{A as R,z as P,d as V,e as T,U as $,N as j,j as z,_ as D,f as B,k as F,g as U,w as E,h as L,o as a,c as _,a as e,F as A,r as C,t as l,C as O,u as o,H as m,y as H,x as f,D as w,i as k,p as M,b as G}from"./index-66d0181f.js";import{u as J}from"./user-6b361a77.js";const x=R(),S=P(),I=V(),g=J(),K=()=>{var c,u,i,p;S.sending_order=!0;const t=S.cart.products.map(d=>({product_instance_id:d.product.id,quantity:d.quantity})),s=S.cart.additions.map(d=>({aditional_item_instance_id:d.id,quantity:d.quantity})),r=I.location.site.site_id,n=I.location.neigborhood.delivery_price,b=S.cart.order_notes,v={user_name:g.user.name,user_phone:(c=g.user.phone_number)==null?void 0:c.split(" ").join(""),user_address:` ${g.user.address} ${(i=(u=I.location)==null?void 0:u.neigborhood)==null?void 0:i.name}`||""};return{order_products:t,site_id:r,delivery_person_id:4,payment_method_id:(p=g.user.payment_method_option)==null?void 0:p.id,delivery_price:n,order_notes:b||"SIN NOTAS",user_data:v,order_aditionals:s}},Q={async sendOrder(){const t=K(),s=P();if(!W(t))return s.sending_order=!1,null;try{x.setLoading(!0,`enviando tu pedido ${g.user.name}`);const r=await T.post(`${$}/order`,t);if(r.status===200)s.sending_order=!1,s.last_order=r.data,x.setLoading(!1,"enviando tu pedido"),j.sendTrackingEvent("Purchase",{total:s.cart.total_cost,currency:"COP",items:s.cart.products.map(n=>({id:n.product.id,name:n.product.product_name,quantity:n.quantity,price:n.product.price}))}),z.push("/gracias");else return console.error("An error occurred while sending the order:",r.status),alert("An error occurred while sending the order. Please try again."),x.setLoading(!1,"enviando tu pedido"),s.sending_order=!1,null}catch(r){return console.error("An error occurred while sending the order:",r),x.setLoading(!1,"enviando tu pedido"),s.sending_order=!1,alert("An error occurred while sending the order. Please check your internet connection and try again."),s.sending_order=!1,null}}};function W(t){const s=P();return t.order_products.every(r=>r.product_instance_id&&r.quantity)?!t.user_data.user_name||t.user_data.user_name.trim()==""||!t.user_data.user_phone||t.user_data.user_phone.trim()==""||!t.user_data.user_address||t.user_data.user_address.trim()==""?(alert("Sus datos estan incompletos por favor reviselos"),s.sending_order=!1,!1):!t.site_id||!t.delivery_price?(alert("Site information is missing. Please select a valid site."),s.sending_order=!1,!1):!0:(alert("Some products in your cart are missing details."),s.sending_order=!1,!1)}const y=t=>(M("data-v-7f7b98eb"),t=t(),G(),t),X={class:"p-1 my-5 md:my-0 col-12"},Y={style:{position:"sticky",top:"5rem","border-radius":"0.5rem","z-index":"1000"},class:"col-12 p-3 p-shadow m-0"},Z=y(()=>e("h5",null,[e("b",null,"Resumen")],-1)),ee=y(()=>e("h5",null,[e("b",null,"productos")],-1)),te={class:"grid mb-0 pb-0"},se={class:"col-6 py-2 mb-1"},oe={style:{"min-width":"3rem"}},re={class:"col-6 my-0 text-right py-2"},ne={class:"col-12 p-0 mt-1"},ae={class:"mb-0"},ie={class:"mb-1 text-center"},de={style:{display:"flex",width:"100%",gap:"1rem","justify-content":"space-between"}},le={class:"text adicion",style:{"text-transform":""}},ce={key:0,class:"pl-2 text-sm"},ue=y(()=>e("hr",{class:"p-0 mt-2"},null,-1)),_e={class:"grid"},pe=y(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Subtotal")])],-1)),he={class:"col-6 my-0 text-right py-0"},ye=y(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Domicilio")])],-1)),me={class:"col-6 my-0 text-right py-0"},ge=y(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Total")])],-1)),be={class:"col-6 my-0 text-right py-0"},ve={__name:"resumen",setup(t){const s=B(!1),r=F(),n=P(),b=V(),v=B({}),q=()=>{v.value=n.cart.additions.reduce((c,u)=>{let i=u.group;return c[i]||(c[i]=[]),c[i].push(u),c},{})};return U(()=>{q()}),E(()=>n.cart.additions,()=>{q()},{deep:!0}),(c,u)=>{const i=L("Button"),p=L("router-link");return a(),_("div",X,[e("div",Y,[Z,ee,(a(!0),_(A,null,C(o(n).cart.products,d=>(a(),_("div",te,[e("div",se,[e("span",null,[e("span",oe,[e("b",null,l(d.quantity),1)]),O(" "+l(d.product.product_name),1)])]),e("div",re,[e("span",null,l(o(m)(d.total_cost)),1)])]))),256)),e("div",ne,[(a(!0),_(A,null,C(v.value,(d,N)=>(a(),_("div",{class:"p-0 mb-2",key:N,style:{position:"relative","border-radius":"0.3rem"}},[e("div",ae,[e("span",ie,[e("b",null,l(N),1)]),(a(!0),_(A,null,C(d,h=>(a(),_("div",{key:h.aditional_item_instance_id,style:{display:"flex",gap:"1rem","align-items":"center"}},[e("div",de,[e("span",le,[e("span",null,[e("b",null,l(h.quantity),1)]),O(" "+l(h.name),1)]),h.price>0?(a(),_("span",ce,[e("b",null,l(o(m)(h.price*h.quantity)),1)])):H("",!0)])]))),128))])]))),128))]),ue,e("div",_e,[pe,e("div",he,[e("span",null,[e("b",null,l(o(m)(o(n).cart.total_cost)),1)])]),ye,e("div",me,[e("span",null,[e("b",null,l(o(m)(o(b).location.neigborhood.delivery_price)),1)])]),ge,e("div",be,[e("span",null,[e("b",null,l(o(m)(o(n).cart.total_cost+o(b).location.neigborhood.delivery_price)),1)])])]),o(r).path.includes("cart")?(a(),f(p,{key:0,to:"/SALCHIPAPAS/3"},{default:w(()=>[k(i,{outlined:"",icon:"pi pi-shopping-cart",label:"Seguir comprando",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})):(a(),f(p,{key:1,to:"/cart"},{default:w(()=>[k(i,{outlined:"",icon:"pi pi-arrow-left",label:"Volver al carrito",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})),o(r).path.includes("cart")?(a(),f(p,{key:2,to:"/pay"},{default:w(()=>[k(i,{iconPos:"right",icon:"pi pi-arrow-right",label:"Pedir",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}})]),_:1})):(a(),f(p,{key:3,to:"/pay"},{default:w(()=>[k(i,{disabled:o(n).sending_order,onClick:u[0]||(u[0]=()=>{o(Q).sendOrder(),s.value=!0}),iconPos:"right",icon:"pi pi-arrow-right",label:"Finalizar pedido",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}},null,8,["disabled"])]),_:1}))])])}}},ke=D(ve,[["__scopeId","data-v-7f7b98eb"]]);export{ke as r};
