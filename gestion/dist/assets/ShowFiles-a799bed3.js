import{_ as H,r as c,u as Y,y as K,o as I,b as _,d as Q,e as W,g as s,f as o,j as p,F as X,U as E,l as g,t as b,h as P,m as Z,Q as N,R as T,n as ee,v as te,x as oe}from"./index-351d7858.js";import{_ as ae}from"./document_image-852a5261.js";import{b as se}from"./dropDownAux-31247fcf.js";import{u as V}from"./sendFileService-8af8e6c5.js";/* empty css                                                                  */const u=w=>(te("data-v-a15254f9"),w=w(),oe(),w),le={class:"grid col-12 m-auto",style:{"box-shadow":"0 0 20px rgba(0, 0, 0, 0.26)","border-radius":"1rem",overflow:"hidden"}},ne={class:"col-12 p-0"},ie={class:""},re=u(()=>o("span",{class:"p-column-title"},"Image",-1)),de=u(()=>o("img",{src:ae,class:"shadow-2",width:"100"},null,-1)),ce=u(()=>o("div",null,null,-1)),ue=u(()=>o("span",{class:"p-column-title"},"name",-1)),pe=u(()=>o("span",{class:"p-column-title"},"Category",-1)),me={class:"col-12 p-0",style:{"max-width":""}},ve=u(()=>o("label",{for:"position"},"FECHA DE RENOVACION",-1)),_e={class:"p-3",style:{"background-color":"rgba(115, 255, 76, 0.306)"}},he=u(()=>o("i",{class:"pi pi-check",style:{color:"slateblue"}},null,-1)),ye={class:"grid",style:{display:"flex","justify-content":"space-between"}},fe={class:"col-12 xl:col-6"},ge={class:"col-12 xl:col-6"},be={class:"grid",style:{display:"flex",padding:"0",margin:"0"}},we={class:"col-12 xl:col-6"},Ce=u(()=>o("label",{for:"position"},"TIPO DE DOCUMENTO",-1)),Se={class:"col-12 xl:col-6"},ke=u(()=>o("label",{for:"position"},"FECHA DE RENOVACION",-1)),De={class:"p-3",style:{"background-color":"rgba(19, 164, 0, 0.306)"}},Oe=u(()=>o("i",{class:"pi pi-check",style:{color:"slateblue"}},null,-1)),Re={style:{display:"flex","justify-content":"space-between"}},Ee={__name:"ShowFiles",setup(w){const $=c([]),r=c(),d=c(),U=c(["CÁMARA DE COMERCIO","USO DE SUELOS","RUT","BOMBEROS","CONCEPTO SANITARIO","SAYCO Y ACIMPRO"]),R=c(),h=c(""),v=c(""),y=Y(),f=c({}),C=K();$.value=R.value;const x=t=>{const e=t.target.files[0];e&&(console.log("Archivo seleccionado:",e),r.value=e)},F=async t=>{let e="post";const i=`${E}/site-document/`,l={method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};await fetch(i,l).then(n=>{if(!n.ok)throw new Error(`Error en la solicitud: ${n.status}`);return D(),n.json()}).then(n=>{}).catch(n=>{})},A=async()=>{try{const t=`${E}/get-site-documents-info/${y.params.site_id}`,e=await fetch(t);if(console.log(e),!e.ok)return;const i=await e.json();R.value=i}catch(t){console.error("Error al enviar la solicitud:",t)}},M=async t=>{let e="put";const i={...t},l=`${E}/site-document/${i.document_id}`;i.renovation_date=v.value;const n={method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)};try{const m=await fetch(l,n);if(!m.ok)throw new Error(`Error en la solicitud: ${m.status}`);const O=await m.json();return D(),C.add({severity:"success",summary:"Actualización exitosa",detail:"Documento actualizado correctamente",life:3e3}),O}catch(m){C.add({severity:"error",summary:"Error en la actualización",detail:m.message,life:3e3})}};I(()=>{A()}),I(()=>{const t=localStorage.getItem("currentSiteFiles");t&&(f.value=JSON.parse(t))});const S=c(!1),k=c(!1),z=(t,e,i)=>{{const l={document_name:`${f.value.site_name} ${h.value}`,document_type:h.value,renovation_date:v.value,site_id:y.params.site_id};F(l),V(t,e,i),C.add({severity:"success",summary:"hecho",detail:"",life:3e3}),D()}},j=(t,e)=>{console.log($,h.value),`${d.value.document_name}`,d.value.document_type,v.value,y.params.site_id,console.log(e),M(e),V(t,d.value.document_type,y.params.site_id),C.add({severity:"success",summary:"hecho",detail:"",life:3e3}),D()},q=t=>{S.value=!0,d.value=t},B=t=>{k.value=!0,d.value=t},D=()=>{S.value=!1,k.value=!1,r.value=null,A()};return(t,e)=>{const i=_("Toast"),l=_("Button"),n=_("Column"),m=_("Calendar"),O=_("Dialog"),L=_("Dropdown"),G=_("DataTable");return Q(),W(X,null,[s(i),o("div",le,[o("div",ne,[o("div",ie,[s(G,{ref:"dt",value:R.value,dataKey:"id",paginator:!0,rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} products",responsiveLayout:"scroll",scrollable:"","scroll-height":"62vh",frozenValue:t.lockedCustomers},{header:p(()=>[s(l,{label:"SUBIR UN DOCUMENTO",style:{width:"max-content"},class:"p-button-rounded p-button-danger mr-0 mt-5",onClick:e[0]||(e[0]=a=>B())})]),default:p(()=>[s(n,{header:"",headerStyle:"width:0%; min-width:5rem;"},{body:p(a=>[re,de,ce]),_:1}),s(n,{field:"name",header:"Tipo de  Documento",sortable:!0,headerStyle:"width:30%; min-width:5rem; "},{body:p(a=>[ue,g(" "+b(a.data.document_type),1)]),_:1}),s(n,{field:"position",header:"Nombre ",sortable:!0,headerStyle:"width:30%; min-width:10rem;"},{body:p(a=>[pe,g(" "+b(a.data.document_name),1)]),_:1}),s(n,{field:"birth_date",header:"Fecha de renovacion",sortable:!0,headerStyle:"width:12%; min-width:10rem;"},{body:p(a=>[g(b(a.data.renovation_date),1)]),_:1}),s(n,{fieldheaderStyle:"width:30%; min-width:10rem;",frozen:"",alignFrozen:"right"},{body:p(a=>[s(l,{label:"DESCARGAR",style:{width:"100%"},class:"p-button-rounded p-button-success mr-2 mb-2",onClick:J=>P(se)(P(y).params.site_id,a.data.document_type)},null,8,["onClick"]),s(l,{label:"RENOVAR",style:{width:"100%"},class:"p-button-rounded p-button-danger mr-0",onClick:J=>q(a.data)},null,8,["onClick"])]),_:1}),s(O,{class:"p-0",closable:!0,style:Z([{"max-width":"500px"},{width:"30vw",padding:"0px"}]),header:` CARGAR ${d.value?d.value.document_type:""} PARA ${f.value.site_name}`,visible:S.value,"onUpdate:visible":e[4]||(e[4]=a=>S.value=a),breakpoints:{"960px":"75vw"},modal:!0},{default:p(()=>[o("input",{ref:"fileInput",type:"file",accept:".pdf",onChange:x,style:{display:"none"}},null,544),o("div",me,[ve,s(m,{id:"entry_date",style:{width:"100%",margin:"20px 0"},modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),required:"true",autofocus:""},null,8,["modelValue"])]),N(o("p",_e,[he,g(" "+b(r.value?`${r.value.name} :    si este no es su documento por favor carguelo`:""),1)],512),[[T,r.value]]),o("div",ye,[o("div",fe,[s(l,{label:"Seleccionar documento",class:"col-12",style:{"background-color":"var(--primary-color)"},onClick:e[2]||(e[2]=a=>{t.$refs.fileInput.click()})})]),o("div",ge,[s(l,{class:"col-12",label:"Enviar",style:{"background-color":"var(--primary-color)"},onClick:e[3]||(e[3]=a=>j(r.value,d.value))})])])]),_:1},8,["header","visible"]),s(O,{header:` CARGAR ${d.value?d.value:""} PARA ${f.value.site_name}`,visible:k.value,"onUpdate:visible":e[9]||(e[9]=a=>k.value=a),breakpoints:{"960px":"75vw"},style:{width:"50vw",padding:"50p0x"},modal:!0},{default:p(()=>[o("div",be,[o("div",we,[Ce,s(L,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=a=>h.value=a),modelModifiers:{trim:!0},options:U.value,placeholder:"",required:"true",class:ee({"p-invalid":t.submitted}),style:{width:"100%",margin:"20px 0"}},null,8,["modelValue","options","class"])]),o("div",Se,[ke,s(m,{id:"entry_date",style:{width:"100%",margin:"20px 0"},modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=a=>v.value=a),required:"true",autofocus:""},null,8,["modelValue"])])]),o("input",{ref:"fileInput",type:"file",accept:".pdf",onChange:x,style:{display:"none"}},null,544),N(o("p",De,[Oe,g(" "+b(r.value?`${r.value.name} :    verifique si este es su documeto antes de envirlo`:""),1)],512),[[T,r.value]]),o("div",Re,[s(l,{label:"Seleccionar documento",style:{width:"40%","background-color":"var(--primary-color)"},onClick:e[7]||(e[7]=a=>{t.$refs.fileInput.click()})}),s(l,{label:"Enviar",style:{width:"40%","background-color":"var(--primary-color)"},onClick:e[8]||(e[8]=a=>z(r.value,h.value,f.value.site_id))})])]),_:1},8,["header","visible"])]),_:1},8,["value","frozenValue"])])])])],64)}}},Ne=H(Ee,[["__scopeId","data-v-a15254f9"]]);export{Ne as default};
