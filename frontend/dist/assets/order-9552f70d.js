import{r as t,G as p,U as i}from"./index-253f89ff.js";const g=t({}),n=t(""),h=t(!1),m=JSON.parse(localStorage.getItem("currentNeigborhood")).currenNeigborhood.name,S=t(""),v=t(["Recoger en local","Efectivo","Pago con tarjeta (datafono),"]),_=async e=>{const a=`${i}/user`;e.user_address=`${e.user_address} ${m} `,console.log(e);const s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};try{const o=await fetch(a,s);if(!o.ok)throw new Error(`Error en la solicitud para obtener user_id: ${o.status}`);return(await o.json()).user_id}catch(o){throw console.error("Error al obtener user_id:",o),o}},N=async()=>{const a=await(await fetch("https://backend.salchimonster.com/server_time")).json(),s=g.value;s.site_id=JSON.parse(localStorage.getItem("currentNeigborhood")).currenSiteId;const o=await _(s),c={order_products:JSON.parse(localStorage.getItem("cart")).products,user_id:o,site_id:JSON.parse(localStorage.getItem("currentNeigborhood")).currenSiteId,order_status:{status:"generada",timestamp:a},payment_method:S.value,delivery_person_id:4,status_history:[{}],delivery_price:p.value.deliveryPrice,order_notes:n.value==null||n.value==""?"sin notas":n.value};let l="POST";const d=`${i}/order`,u={method:l,headers:{"Content-Type":"application/json"},body:JSON.stringify(c)};await fetch(d,u).then(r=>{if(!r.ok)throw new Error(`Error en la solicitud: ${r.status}`);return r.json()}).then(r=>{console.log("Datos actualizados:",r),y(),h.value=!0}).catch(r=>{console.error("Error en la solicitud:",r)})};function y(){const e=JSON.parse(localStorage.getItem("cart"));e&&e.products?(e.products=[],localStorage.setItem("cart",JSON.stringify(e)),console.log("Se eliminaron los productos del carrito y se actualiz√≥ el LocalStorage.")):console.log('El carrito no tiene la propiedad "products" o no existe en el LocalStorage.')}export{v as a,N as b,n as o,S as p,h as s,g as u};
