import{d as s,U as i,G as g}from"./index-ce6809f9.js";const m=s({}),n=s(""),h=s(!1),_=JSON.parse(localStorage.getItem("currentNeigborhood")).currenNeigborhood.name,l=s(""),v=s(["Recoger en local","Efectivo","Pago con tarjeta (datafono),"]),f=async r=>{const a=`${i}/user`;r.user_address=`${r.user_address} ${_} `,console.log(r);const e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)};try{const o=await fetch(a,e);if(!o.ok)throw new Error(`Error en la solicitud para obtener user_id: ${o.status}`);return(await o.json()).user_id}catch(o){throw console.error("Error al obtener user_id:",o),o}},b=async()=>{const a=await(await fetch(`${i}/server_time`)).json(),e=m.value;if(!e.user_name||!e.user_name.trim()){alert("El nombre es obligatorio.");return}if(!e.user_phone||!e.user_phone.trim()){alert("El teléfono es obligatorio.");return}if(!e.user_address||!e.user_address.trim()){alert("La dirección es obligatoria.");return}if(!l.value){alert("Por favor seleccione un metodo de pago");return}e.site_id=JSON.parse(localStorage.getItem("currentNeigborhood")).currenSiteId;const o=await f(e),c={order_products:JSON.parse(localStorage.getItem("cart")).products,user_id:o,user_data:e,site_id:JSON.parse(localStorage.getItem("currentNeigborhood")).currenSiteId,order_status:{status:"generada",timestamp:a},payment_method:l.value,delivery_person_id:4,status_history:[{}],delivery_price:g.value.deliveryPrice,order_notes:n.value==null||n.value==""?"sin notas":n.value};let d="POST";const u=`${i}/order`,p={method:d,headers:{"Content-Type":"application/json"},body:JSON.stringify(c)};await fetch(u,p).then(t=>{if(!t.ok)throw new Error(`Error en la solicitud: ${t.status}`);return t.json()}).then(t=>{console.log("Datos actualizados:",t),S(),h.value=!0}).catch(t=>{console.error("Error en la solicitud:",t)})};function S(){const r=JSON.parse(localStorage.getItem("cart"));r&&r.products?(r.products=[],localStorage.setItem("cart",JSON.stringify(r)),console.log("Se eliminaron los productos del carrito y se actualizó el LocalStorage.")):console.log('El carrito no tiene la propiedad "products" o no existe en el LocalStorage.')}export{v as a,b,n as o,l as p,h as s,m as u};
