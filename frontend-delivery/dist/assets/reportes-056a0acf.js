import{B as h,U as d}from"./index-aa9b2e8b.js";const D=h("reportes",{persist:{key:"reportes",storage:localStorage,paths:["dateRange","salesReport","selectedSites","order_status","visibleNotifications"]},state:()=>({dateRange:{startDate:new Date(new Date().setDate(new Date().getDate()-7)),endDate:new Date},salesReport:{total_sales:{total_sales:0,total_orders:0,average_ticket:0}},selectedSites:[],order_status:"enviada",ventasCharData:{},ordersCharData:{},ticketsCharData:{},loading:!1,visibleNotifications:!1,visibleOrder:{visible:!1,order:{}},Loading:{visible:!1,tittle:"Cargando"},sitesStatus:[]}),getters:{lastWeek:e=>{const t=new Date,s=new Date;return s.setDate(t.getDate()-7),{startDate:s,endDate:t}},lastMidMonth:e=>{const t=new Date,s=new Date;return s.setDate(t.getDate()-14),{startDate:s,endDate:t}},lastMonth:e=>{const t=new Date,s=new Date;return s.setDate(t.getDate()-28),{startDate:s,endDate:t}},dateRangeDifference(e){const t=new Date;t.setHours(0,0,0,0);const s=new Date(t);s.setDate(s.getDate()+1);const o=new Date(t);o.setDate(o.getDate()-1);const r=new Date(e.dateRange.startDate);r.setHours(0,0,0,0);const a=new Date(e.dateRange.endDate);a.setHours(0,0,0,0);const n=Math.abs(a-r),c=Math.ceil(n/(1e3*60*60*24));let i="";if(r.getTime()===t.getTime()&&a.getTime()===s.getTime())i="Hoy";else if(r.getTime()===o.getTime()&&a.getTime()===t.getTime())i="Ayer";else switch(c){case 2:i="Últimos 2 días";break;case 8:i="Últimos 7 días";break;case 15:i="Últimos 14 días";break;case 29:i="Últimos 28 días";break;default:i=null}return{diffDays:c,rangeName:i}}},actions:{async fetchSalesReport(){const e=this.formatDate(this.dateRange.startDate),t=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(a=>a.site_id).join(","),o=new URLSearchParams({site_ids:s,status:this.order_status,start_date:e,end_date:t}),r=`${d}/sales_report?${o.toString()}`;try{this.setLoading(!0,"cargando reporte");const a=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw this.setLoading(!1,"cargando reporte"),new Error(`HTTP error! status: ${a.status}`);const n=await a.json();this.salesReport=n,this.fetchDilyReport(),this.fetchDilyOrdersReport(),this.fetchTicketsReport(),console.log(n),this.setLoading(!1,"cargando reporte")}catch(a){console.error("Fetch error:",a),this.setLoading(!1,"cargando reporte")}},formatDate(e){const t=new Date(e),s=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getDate().toString().padStart(2,"0");return`${s}-${o}-${r}`},setDateRange(e,t){this.dateRange.startDate=new Date(e),this.dateRange.endDate=new Date(t)},async fetchDilyReport(){const e=this.formatDate(this.dateRange.startDate),t=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(a=>a.site_id).join(","),o=new URLSearchParams({site_ids:s,status:this.order_status,start_date:e,end_date:t}),r=`${d}/daily_sales?${o.toString()}`;try{const a=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=await a.json();return this.setChartData(n),n;console.log(n)}catch(a){console.error("Fetch error:",a)}},async fetchDilyOrdersReport(){const e=this.formatDate(this.dateRange.startDate),t=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(a=>a.site_id).join(","),o=new URLSearchParams({site_ids:s,status:this.order_status,start_date:e,end_date:t}),r=`${d}/daily_orders?${o.toString()}`;try{const a=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=await a.json();return this.setCharOrdersData(n),n;console.log(n)}catch(a){console.error("Fetch error:",a)}},async fetchTicketsReport(){const e=this.formatDate(this.dateRange.startDate),t=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(a=>a.site_id).join(","),o=new URLSearchParams({site_ids:s,status:this.order_status,start_date:e,end_date:t}),r=`${d}/daily_average_ticket?${o.toString()}`;try{const a=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=await a.json();return this.setCharTicketsData(n),n;console.log(n)}catch(a){console.error("Fetch error:",a)}},setChartData(e){const t=[],s=[];e.forEach(o=>{Object.keys(o).forEach(r=>{t.includes(r)||t.push(r)}),Object.values(o).forEach(r=>{s.push(r)})}),this.ventasCharData={labels:t,datasets:[{label:"Venta",data:s,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setCharOrdersData(e){const t=[],s=[];e.forEach(o=>{Object.keys(o).forEach(r=>{t.includes(r)||t.push(r)}),Object.values(o).forEach(r=>{s.push(r)})}),this.ordersCharData={labels:t,datasets:[{label:"Venta",data:s,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setCharTicketsData(e){const t=[],s=[];e.forEach(o=>{Object.keys(o).forEach(r=>{t.includes(r)||t.push(r)}),Object.values(o).forEach(r=>{s.push(r)})}),this.ticketsCharData={labels:t,datasets:[{label:"Venta",data:s,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setSelectedSites(e){this.selectedSites=e,localStorage.setItem("selectedSites",JSON.stringify(e))},setOrderStatus(e){this.order_status=e,localStorage.setItem("orderStatus",e)},toogleVisibleNotifications(e){this.visibleNotifications=!this.visibleNotifications},setLoading(e,t="cargando"){var s;((s=this.loading)==null?void 0:s.visible)==!0&&e==!0||(e?this.loading={visible:e,tittle:e==!1?"cargando":t}:setTimeout(()=>{this.loading={visible:e,tittle:e==!1?"cargando":t}},0))},setVisibleOrder(e,t={}){e||(this.visibleOrder.order={}),this.visibleOrder={visible:e,order:t}},async setSitesStatus(){try{const e=await fetch(`${d}/sites/online-status`);if(!e.ok)throw"paila";this.sitesStatus=await e.json()}catch{}},startSitesStatusUpdate(){this.setSitesStatus(),setInterval(async()=>{await this.setSitesStatus()},3e3)}}});export{D as u};
