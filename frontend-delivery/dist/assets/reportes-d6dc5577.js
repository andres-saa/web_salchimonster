import{B as u,k as n,U as c}from"./index-7a970916.js";class l extends Error{}l.prototype.name="InvalidTokenError";function f(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,a)=>{let o=a.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function g(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return f(e)}catch{return atob(e)}}function D(t,e){if(typeof t!="string")throw new l("Invalid token specified: must be a string");e||(e={});const a=e.header===!0?0:1,o=t.split(".")[a];if(typeof o!="string")throw new l(`Invalid token specified: missing part #${a+1}`);let r;try{r=g(o)}catch(s){throw new l(`Invalid token specified: invalid base64 for part #${a+1} (${s.message})`)}try{return JSON.parse(r)}catch(s){throw new l(`Invalid token specified: invalid json for part #${a+1} (${s.message})`)}}u("user",{persist:{key:"user",storage:localStorage,paths:["userData"]},state:()=>({userData:{}}),getters:{rawUserData(){return D(this.userData.access_token)}},actions:{setUserData(t){this.userData=t}}});n();n();n();n();n();n();n();n(!1);n(!1);n(!0);n();n(1);n({});n({});n(!1);n(!0);n(!1);n({});const m=n({});function w(t){if(t)return t.toLocaleString("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0})}const y=u("reportes",{persist:{key:"reportes",storage:localStorage,paths:["dateRange","salesReport","selectedSites","order_status","visibleNotifications"]},state:()=>({dateRange:{startDate:new Date(new Date().setDate(new Date().getDate()-7)),endDate:new Date},salesReport:{total_sales:{total_sales:0,total_orders:0,average_ticket:0}},selectedSites:[],order_status:"enviada",ventasCharData:{},ordersCharData:{},ticketsCharData:{},loading:!1,visibleNotifications:!1,visibleOrder:{visible:!1,order:{}},Loading:{visible:!1,tittle:"Cargando"},sitesStatus:[]}),getters:{lastWeek:t=>{const e=new Date,a=new Date;return a.setDate(e.getDate()-7),{startDate:a,endDate:e}},lastMidMonth:t=>{const e=new Date,a=new Date;return a.setDate(e.getDate()-14),{startDate:a,endDate:e}},lastMonth:t=>{const e=new Date,a=new Date;return a.setDate(e.getDate()-28),{startDate:a,endDate:e}},dateRangeDifference(t){const e=new Date;e.setHours(0,0,0,0);const a=new Date(e);a.setDate(a.getDate()+1);const o=new Date(e);o.setDate(o.getDate()-1);const r=new Date(t.dateRange.startDate);r.setHours(0,0,0,0);const s=new Date(t.dateRange.endDate);s.setHours(0,0,0,0);const i=Math.abs(s-r),h=Math.ceil(i/(1e3*60*60*24));let d="";if(r.getTime()===e.getTime()&&s.getTime()===a.getTime())d="Hoy";else if(r.getTime()===o.getTime()&&s.getTime()===e.getTime())d="Ayer";else switch(h){case 2:d="Últimos 2 días";break;case 8:d="Últimos 7 días";break;case 15:d="Últimos 14 días";break;case 29:d="Últimos 28 días";break;default:d=null}return{diffDays:h,rangeName:d}}},actions:{async fetchSalesReport(){const t=this.formatDate(this.dateRange.startDate),e=this.formatDate(this.dateRange.endDate),a=this.selectedSites.map(s=>s.site_id).join(","),o=new URLSearchParams({site_ids:a,status:this.order_status,start_date:t,end_date:e}),r=`${c}/sales_report?${o.toString()}`;try{this.setLoading(!0,"cargando reporte");const s=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw this.setLoading(!1,"cargando reporte"),new Error(`HTTP error! status: ${s.status}`);const i=await s.json();this.salesReport=i,this.fetchDilyReport(),this.fetchDilyOrdersReport(),this.fetchTicketsReport(),console.log(i),this.setLoading(!1,"cargando reporte")}catch(s){console.error("Fetch error:",s),this.setLoading(!1,"cargando reporte")}},formatDate(t){const e=new Date(t),a=e.getFullYear(),o=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0");return`${a}-${o}-${r}`},setDateRange(t,e){this.dateRange.startDate=new Date(t),this.dateRange.endDate=new Date(e)},async fetchDilyReport(){const t=this.formatDate(this.dateRange.startDate),e=this.formatDate(this.dateRange.endDate),a=this.selectedSites.map(s=>s.site_id).join(","),o=new URLSearchParams({site_ids:a,status:this.order_status,start_date:t,end_date:e}),r=`${c}/daily_sales?${o.toString()}`;try{const s=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const i=await s.json();return this.setChartData(i),i;console.log(i)}catch(s){console.error("Fetch error:",s)}},async fetchDilyOrdersReport(){const t=this.formatDate(this.dateRange.startDate),e=this.formatDate(this.dateRange.endDate),a=this.selectedSites.map(s=>s.site_id).join(","),o=new URLSearchParams({site_ids:a,status:this.order_status,start_date:t,end_date:e}),r=`${c}/daily_orders?${o.toString()}`;try{const s=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const i=await s.json();return this.setCharOrdersData(i),i;console.log(i)}catch(s){console.error("Fetch error:",s)}},async fetchTicketsReport(){const t=this.formatDate(this.dateRange.startDate),e=this.formatDate(this.dateRange.endDate),a=this.selectedSites.map(s=>s.site_id).join(","),o=new URLSearchParams({site_ids:a,status:this.order_status,start_date:t,end_date:e}),r=`${c}/daily_average_ticket?${o.toString()}`;try{const s=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const i=await s.json();return this.setCharTicketsData(i),i;console.log(i)}catch(s){console.error("Fetch error:",s)}},setChartData(t){const e=[],a=[];t.forEach(o=>{Object.keys(o).forEach(r=>{e.includes(r)||e.push(r)}),Object.values(o).forEach(r=>{a.push(r)})}),this.ventasCharData={labels:e,datasets:[{label:"Venta",data:a,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setCharOrdersData(t){const e=[],a=[];t.forEach(o=>{Object.keys(o).forEach(r=>{e.includes(r)||e.push(r)}),Object.values(o).forEach(r=>{a.push(r)})}),this.ordersCharData={labels:e,datasets:[{label:"Venta",data:a,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setCharTicketsData(t){const e=[],a=[];t.forEach(o=>{Object.keys(o).forEach(r=>{e.includes(r)||e.push(r)}),Object.values(o).forEach(r=>{a.push(r)})}),this.ticketsCharData={labels:e,datasets:[{label:"Venta",data:a,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setSelectedSites(t){this.selectedSites=t,localStorage.setItem("selectedSites",JSON.stringify(t))},setOrderStatus(t){this.order_status=t,localStorage.setItem("orderStatus",t)},toogleVisibleNotifications(t){this.visibleNotifications=!this.visibleNotifications},setLoading(t,e="cargando"){var a;((a=this.loading)==null?void 0:a.visible)==!0&&t==!0||(t?this.loading={visible:t,tittle:t==!1?"cargando":e}:setTimeout(()=>{this.loading={visible:t,tittle:t==!1?"cargando":e}},0))},setVisibleOrder(t,e={}){t||(this.visibleOrder.order={}),this.visibleOrder={visible:t,order:e}},async setSitesStatus(){try{const t=await fetch(`${c}/sites/online-status`);if(!t.ok)throw"paila";this.sitesStatus=await t.json()}catch{}},startSitesStatusUpdate(){this.setSitesStatus(),setInterval(async()=>{await this.setSitesStatus()},3e3)}}});export{w as f,m as s,y as u};
