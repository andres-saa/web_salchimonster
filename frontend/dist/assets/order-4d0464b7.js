import{r as s,G as g,U as i}from"./index-164197a4.js";const m=s({}),c=s(""),S=s(!1),_=JSON.parse(localStorage.getItem("currentNeigborhood")).currenNeigborhood.name,y=s(""),w=s(["Recoger en local","Efectivo","Pago con tarjeta (datafono),"]),f=async e=>{const a=`${i}/user`;e.user_address=`${e.user_address} ${_} `,console.log(e);const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};try{const o=await fetch(a,t);if(!o.ok)throw new Error(`Error en la solicitud para obtener user_id: ${o.status}`);return(await o.json()).user_id}catch(o){throw console.error("Error al obtener user_id:",o),o}},O=async()=>{const a=await(await fetch("https://backend.salchimonster.com/server_time")).json(),{fecha:t,hora:o}=a,n=m.value;n.site_id=JSON.parse(localStorage.getItem("currentNeigborhood")).currenSiteId;const l=await f(n),d={order_products:JSON.parse(localStorage.getItem("cart")).products,user_id:l,site_id:JSON.parse(localStorage.getItem("currentNeigborhood")).currenSiteId,order_status:{status:"generada",timestamp:`${t.a}-${t.m}-${t.d} ${o.h}:${o.m}`},payment_method:y.value,delivery_person_id:4,status_history:[{}],delivery_price:g.value.deliveryPrice,order_notes:c.value==null||c.value==""?"sin notas":c.value};let u="POST";const p=`${i}/order`,h={method:u,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)};await fetch(p,h).then(r=>{if(!r.ok)throw new Error(`Error en la solicitud: ${r.status}`);return r.json()}).then(r=>{console.log("Datos actualizados:",r),v(),S.value=!0}).catch(r=>{console.error("Error en la solicitud:",r)})};function v(){const e=JSON.parse(localStorage.getItem("cart"));e&&e.products?(e.products=[],localStorage.setItem("cart",JSON.stringify(e)),console.log("Se eliminaron los productos del carrito y se actualiz√≥ el LocalStorage.")):console.log('El carrito no tiene la propiedad "products" o no existe en el LocalStorage.')}export{w as a,O as b,c as o,y as p,S as s,m as u};
