import{K as V,B as $,A as L,d as N,e as O,U as R,j,_ as z,k as D,f as F,g as T,w as U,h as B,o as r,c,a as e,F as P,r as q,t as a,D as C,u as s,I as m,y as E,x as w,z as k,i as S,p as H,b as K}from"./index-1e89a5bc.js";const M=V("user",{persist:{key:"user",storage:localStorage,paths:["user"]},state:()=>({user:{name:"",neigborhood:"",address:"",phone_number:"",payment_method_option:""}}),getters:{fucion:t=>0},actions:{async func(){return func}}}),x=$(),I=L(),A=N(),g=M(),G=()=>{var d,n,_,i;const t=I.cart.products.map(l=>({product_instance_id:l.product.id,quantity:l.quantity})),o=I.cart.additions.map(l=>({aditional_item_instance_id:l.id,quantity:l.quantity})),u=A.location.site.site_id,b=A.location.neigborhood.delivery_price,v=I.cart.order_notes,f={user_name:g.user.name,user_phone:(d=g.user.phone_number)==null?void 0:d.split(" ").join(""),user_address:` ${g.user.address} ${(_=(n=A.location)==null?void 0:n.neigborhood)==null?void 0:_.name}`||""};return{order_products:t,site_id:u,delivery_person_id:4,payment_method_id:(i=g.user.payment_method_option)==null?void 0:i.id,delivery_price:b,order_notes:v||"SIN NOTAS",user_data:f,order_aditionals:o}},J={async sendOrder(){const t=G();if(!Q(t))return null;try{x.setLoading(!0,`enviando tu pedido ${g.user.name}`);const o=await O.post(`${R}/order`,t);if(o.status===200)A.webSocket.send("pedido melo"),x.setLoading(!1,"enviando tu pedido"),j.push("/gracias");else return console.error("An error occurred while sending the order:",o.status),alert("An error occurred while sending the order. Please try again."),x.setLoading(!1,"enviando tu pedido"),null}catch(o){return console.error("An error occurred while sending the order:",o),x.setLoading(!1,"enviando tu pedido"),alert("An error occurred while sending the order. Please check your internet connection and try again."),null}}};function Q(t){return t.order_products.every(o=>o.product_instance_id&&o.quantity)?!t.user_data.user_name||t.user_data.user_name.trim()==""||!t.user_data.user_phone||t.user_data.user_phone.trim()==""||!t.user_data.user_address||t.user_data.user_address.trim()==""?(alert("Sus datos estan incompletos por favor reviselos"),!1):!t.site_id||!t.delivery_price?(alert("Site information is missing. Please select a valid site."),!1):!0:(alert("Some products in your cart are missing details."),!1)}const y=t=>(H("data-v-6d347164"),t=t(),K(),t),W={class:"p-1 my-5 md:my-0 col-12"},X={style:{position:"sticky",top:"5rem","border-radius":"0.5rem","z-index":"1000"},class:"col-12 p-3 p-shadow m-0"},Y=y(()=>e("h5",null,[e("b",null,"Resumen")],-1)),Z=y(()=>e("h5",null,[e("b",null,"productos")],-1)),ee={class:"grid mb-0 pb-0"},te={class:"col-6 py-2 mb-1"},se={style:{"min-width":"3rem"}},oe={class:"col-6 my-0 text-right py-2"},re={class:"col-12 p-0 mt-1"},ne={class:"mb-0"},ae={class:"mb-1 text-center"},ie={style:{display:"flex",width:"100%",gap:"1rem","justify-content":"space-between"}},de={class:"text adicion",style:{"text-transform":""}},le={key:0,class:"pl-2 text-sm"},ce=y(()=>e("hr",{class:"p-0 mt-2"},null,-1)),ue={class:"grid"},_e=y(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Subtotal")])],-1)),pe={class:"col-6 my-0 text-right py-0"},he=y(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Domicilio")])],-1)),ye={class:"col-6 my-0 text-right py-0"},me=y(()=>e("div",{class:"col-6 my-0 py-0"},[e("span",null,[e("b",null,"Total")])],-1)),ge={class:"col-6 my-0 text-right py-0"},be={__name:"resumen",setup(t){const o=D(),u=L(),b=N(),v=F({}),f=()=>{v.value=u.cart.additions.reduce((p,d)=>{let n=d.group;return p[n]||(p[n]=[]),p[n].push(d),p},{})};return T(()=>{f()}),U(()=>u.cart.additions,()=>{f()},{deep:!0}),(p,d)=>{const n=B("Button"),_=B("router-link");return r(),c("div",W,[e("div",X,[Y,Z,(r(!0),c(P,null,q(s(u).cart.products,i=>(r(),c("div",ee,[e("div",te,[e("span",null,[e("span",se,[e("b",null,a(i.quantity),1)]),C(" "+a(i.product.product_name),1)])]),e("div",oe,[e("span",null,a(s(m)(i.total_cost)),1)])]))),256)),e("div",re,[(r(!0),c(P,null,q(v.value,(i,l)=>(r(),c("div",{class:"p-0 mb-2",key:l,style:{position:"relative","border-radius":"0.3rem"}},[e("div",ne,[e("span",ae,[e("b",null,a(l),1)]),(r(!0),c(P,null,q(i,h=>(r(),c("div",{key:h.aditional_item_instance_id,style:{display:"flex",gap:"1rem","align-items":"center"}},[e("div",ie,[e("span",de,[e("span",null,[e("b",null,a(h.quantity),1)]),C(" "+a(h.name),1)]),h.price>0?(r(),c("span",le,[e("b",null,a(s(m)(h.price*h.quantity)),1)])):E("",!0)])]))),128))])]))),128))]),ce,e("div",ue,[_e,e("div",pe,[e("span",null,[e("b",null,a(s(m)(s(u).cart.total_cost)),1)])]),he,e("div",ye,[e("span",null,[e("b",null,a(s(m)(s(b).location.neigborhood.delivery_price)),1)])]),me,e("div",ge,[e("span",null,[e("b",null,a(s(m)(s(u).cart.total_cost+s(b).location.neigborhood.delivery_price)),1)])])]),s(o).path.includes("cart")?(r(),w(_,{key:0,to:"/SALCHIPAPAS/3"},{default:k(()=>[S(n,{outlined:"",icon:"pi pi-shopping-cart",label:"Seguir comprando",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})):(r(),w(_,{key:1,to:"/cart"},{default:k(()=>[S(n,{outlined:"",icon:"pi pi-arrow-left",label:"Volver al carrito",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})),s(o).path.includes("cart")?(r(),w(_,{key:2,to:"/pay"},{default:k(()=>[S(n,{iconPos:"right",icon:"pi pi-arrow-right",label:"Pedir",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}})]),_:1})):(r(),w(_,{key:3,to:"/pay"},{default:k(()=>[S(n,{onClick:d[0]||(d[0]=i=>s(J).sendOrder()),iconPos:"right",icon:"pi pi-arrow-right",label:"Finalizar pedido",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}})]),_:1}))])])}}},fe=z(be,[["__scopeId","data-v-6d347164"]]);export{fe as r,M as u};
